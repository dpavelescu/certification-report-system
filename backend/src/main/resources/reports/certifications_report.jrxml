<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports 
              http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"              name="certifications_report" 
              pageWidth="842" 
              pageHeight="595" 
              orientation="Landscape"
              columnWidth="782" 
              leftMargin="30" 
              rightMargin="30" 
              topMargin="25" 
              bottomMargin="25">
    
    <property name="ireport.zoom" value="1.0"/>
    <property name="ireport.x" value="0"/>
    <property name="ireport.y" value="0"/>
    
    <!-- Parameters -->    <parameter name="REPORT_TITLE" class="java.lang.String" isForPrompting="false">
        <defaultValueExpression><![CDATA["Certifications Report"]]></defaultValueExpression>
    </parameter>
    <parameter name="GENERATION_DATE" class="java.lang.String" isForPrompting="false"/>
    <parameter name="TOTAL_EMPLOYEES" class="java.lang.Integer" isForPrompting="false">
        <defaultValueExpression><![CDATA[0]]></defaultValueExpression>
    </parameter>
    <parameter name="COMPANY_NAME" class="java.lang.String" isForPrompting="false">
        <defaultValueExpression><![CDATA["CertReport Systems"]]></defaultValueExpression>
    </parameter>
      <!-- Employee Demographics Fields (accessed through employee nested object) -->
    <field name="employee.id" class="java.lang.String"/>
    <field name="employee.firstName" class="java.lang.String"/>
    <field name="employee.lastName" class="java.lang.String"/>
    <field name="employee.email" class="java.lang.String"/>
    <field name="employee.department" class="java.lang.String"/>
    <field name="employee.position" class="java.lang.String"/>
    <field name="employee.hireDate" class="java.time.LocalDateTime"/>
    
    <!-- Certification and Activity Data Fields -->
    <field name="certifications" class="java.util.List"/>
      <!-- Variables for statistics -->
    <variable name="DEPT_COUNT" class="java.lang.Integer" calculation="DistinctCount">
        <variableExpression><![CDATA[$F{employee.department}]]></variableExpression>
    </variable>
    <variable name="RECORD_COUNT" class="java.lang.Integer" calculation="Count">
        <variableExpression><![CDATA[1]]></variableExpression>
    </variable>
    
    <!-- Title Section -->
    <title>
        <band height="120" splitType="Stretch">
            <!-- Professional Header Background -->
            <rectangle>
                <reportElement mode="Opaque" x="0" y="0" width="782" height="50" backcolor="#2E5C8A"/>
            </rectangle>            <staticText>
                <reportElement x="0" y="5" width="782" height="40" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="24" isBold="true"/>
                </textElement>
                <text><![CDATA[Certifications Report]]></text>
            </staticText>
            
            <!-- Company Name and Generation Date -->
            <textField>
                <reportElement x="0" y="60" width="400" height="25" forecolor="#555555"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="16" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{COMPANY_NAME}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement x="400" y="60" width="382" height="25" forecolor="#555555"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font fontName="Arial" size="12"/>
                </textElement>
                <textFieldExpression><![CDATA["Generated: " + new java.text.SimpleDateFormat("MMMM dd, yyyy 'at' HH:mm").format(new java.util.Date())]]></textFieldExpression>
            </textField>
            
            <!-- Summary Statistics -->
            <rectangle>
                <reportElement mode="Opaque" x="0" y="95" width="200" height="20" backcolor="#E8F4FD"/>
                <graphicElement>
                    <pen lineWidth="1.0" lineColor="#4A90C2"/>
                </graphicElement>
            </rectangle>
            <staticText>
                <reportElement x="5" y="97" width="100" height="16" forecolor="#2E5C8A"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Total Employees:]]></text>
            </staticText>
            <textField>
                <reportElement x="105" y="97" width="90" height="16" forecolor="#2E5C8A"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$P{TOTAL_EMPLOYEES}]]></textFieldExpression>
            </textField>
        </band>
    </title>
    
    <!-- Section 1: Employee Demographics Header -->
    <columnHeader>
        <band height="70" splitType="Stretch">
            <!-- Section Header -->
            <rectangle>
                <reportElement mode="Opaque" x="0" y="0" width="782" height="30" backcolor="#A23B72"/>
            </rectangle>
            <staticText>
                <reportElement x="10" y="5" width="400" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="14" isBold="true"/>
                </textElement>
                <text><![CDATA[Section 1: Employee Demographics]]></text>
            </staticText>
            
            <!-- Column Headers -->
            <rectangle>
                <reportElement mode="Opaque" x="0" y="40" width="782" height="30" backcolor="#4A90C2"/>
            </rectangle>
            
            <staticText>
                <reportElement x="5" y="45" width="80" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Employee ID]]></text>
            </staticText>
            <staticText>
                <reportElement x="90" y="45" width="120" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Full Name]]></text>
            </staticText>
            <staticText>
                <reportElement x="215" y="45" width="150" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Email Address]]></text>
            </staticText>
            <staticText>
                <reportElement x="370" y="45" width="100" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Department]]></text>
            </staticText>
            <staticText>
                <reportElement x="475" y="45" width="110" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Position]]></text>
            </staticText>
            <staticText>
                <reportElement x="590" y="45" width="80" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Hire Date]]></text>
            </staticText>            <staticText>
                <reportElement x="675" y="45" width="100" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Status]]></text>
            </staticText>
        </band>
    </columnHeader>
    
    <!-- Detail Rows for Employee Data -->
    <detail>
        <band height="30" splitType="Stretch">
            <!-- Alternating Row Colors -->
            <rectangle>
                <reportElement mode="Opaque" x="0" y="0" width="782" height="30" backcolor="#FFFFFF">
                    <printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 == 1]]></printWhenExpression>
                </reportElement>
            </rectangle>
            <rectangle>
                <reportElement mode="Opaque" x="0" y="0" width="782" height="30" backcolor="#F8F9FA">
                    <printWhenExpression><![CDATA[$V{REPORT_COUNT} % 2 == 0]]></printWhenExpression>
                </reportElement>
            </rectangle>
              <!-- Data Fields -->
            <textField>
                <reportElement x="5" y="5" width="80" height="20" forecolor="#333333"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{employee.id}.length() > 8 ? $F{employee.id}.substring(0, 8) + "..." : $F{employee.id}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement x="90" y="5" width="120" height="20" forecolor="#333333"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="9" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{employee.firstName} + " " + $F{employee.lastName}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement x="215" y="5" width="150" height="20" forecolor="#555555"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{employee.email}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement x="370" y="5" width="100" height="20" forecolor="#333333"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{employee.department}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement x="475" y="5" width="110" height="20" forecolor="#333333"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{employee.position}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement x="590" y="5" width="80" height="20" forecolor="#666666"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[new java.text.SimpleDateFormat("MMM dd, yyyy").format(java.sql.Timestamp.valueOf($F{employee.hireDate}))]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement x="675" y="5" width="100" height="20" forecolor="#666666"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font fontName="Arial" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA["N/A"]]></textFieldExpression>
            </textField>
            
            <!-- Bottom Border -->
            <line>
                <reportElement x="0" y="29" width="782" height="1" forecolor="#E0E0E0"/>
            </line>        </band>
    </detail>
    
    <!-- Professional Page Footer -->
    <pageFooter>
        <band height="40" splitType="Stretch">
            <!-- Footer Background -->
            <rectangle>
                <reportElement mode="Opaque" x="0" y="10" width="782" height="25" backcolor="#F0F0F0"/>
                <graphicElement>
                    <pen lineWidth="1.0" lineColor="#CCCCCC"/>
                </graphicElement>
            </rectangle>
            
            <!-- Confidentiality Notice -->
            <staticText>
                <reportElement x="10" y="15" width="300" height="15" forecolor="#666666"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="8" isItalic="true"/>
                </textElement>
                <text><![CDATA[Confidential - For Internal Use Only]]></text>
            </staticText>
            
            <!-- Page Information -->
            <textField>
                <reportElement x="590" y="15" width="180" height="15" forecolor="#666666"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font fontName="Arial" size="9"/>
                </textElement>
                <textFieldExpression><![CDATA["Page " + $V{PAGE_NUMBER}]]></textFieldExpression>
            </textField>
            
            <!-- Report Generation Info -->
            <textField>
                <reportElement x="320" y="15" width="260" height="15" forecolor="#666666"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA["Certifications Report - Generated " + new java.text.SimpleDateFormat("yyyy-MM-dd").format(new java.util.Date())]]></textFieldExpression>
            </textField>
        </band>
    </pageFooter>
      <!-- Summary Band for Additional Sections -->
    <summary>
        <band height="400" splitType="Stretch">
            <!-- Section 2: Certification Summary Header -->
            <rectangle>
                <reportElement mode="Opaque" x="0" y="20" width="782" height="30" backcolor="#F18F01"/>
            </rectangle>
            <staticText>
                <reportElement x="10" y="25" width="400" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="14" isBold="true"/>
                </textElement>
                <text><![CDATA[Section 2: Certification Summary]]></text>
            </staticText>
            
            <!-- Certification Summary Statistics -->
            <staticText>
                <reportElement x="10" y="60" width="150" height="15" forecolor="#333333"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Completed Certifications:]]></text>
            </staticText>
            <textField>
                <reportElement x="170" y="60" width="50" height="15" forecolor="#008000"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{certifications} != null ? ((java.util.List)$F{certifications}).stream().filter(cert -> "COMPLETED".equals(((com.certreport.dto.CertificationDto)cert).getStatus().toString())).count() : 0]]></textFieldExpression>
            </textField>
            
            <staticText>
                <reportElement x="250" y="60" width="150" height="15" forecolor="#333333"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[In-Progress Certifications:]]></text>
            </staticText>
            <textField>
                <reportElement x="410" y="60" width="50" height="15" forecolor="#FF8C00"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{certifications} != null ? ((java.util.List)$F{certifications}).stream().filter(cert -> "IN_PROGRESS".equals(((com.certreport.dto.CertificationDto)cert).getStatus().toString())).count() : 0]]></textFieldExpression>
            </textField>
            
            <staticText>
                <reportElement x="490" y="60" width="150" height="15" forecolor="#333333"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <text><![CDATA[Failed Certifications:]]></text>
            </staticText>
            <textField>
                <reportElement x="650" y="60" width="50" height="15" forecolor="#DC143C"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="10" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{certifications} != null ? ((java.util.List)$F{certifications}).stream().filter(cert -> "FAILED".equals(((com.certreport.dto.CertificationDto)cert).getStatus().toString())).count() : 0]]></textFieldExpression>
            </textField>
            
            <!-- Certification Details Table Header -->
            <rectangle>
                <reportElement mode="Opaque" x="0" y="85" width="782" height="20" backcolor="#E0E0E0"/>
                <graphicElement>
                    <pen lineWidth="1.0" lineColor="#CCCCCC"/>
                </graphicElement>
            </rectangle>
            <staticText>
                <reportElement x="10" y="87" width="200" height="16" forecolor="#333333"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Certification Name]]></text>
            </staticText>
            <staticText>
                <reportElement x="220" y="87" width="100" height="16" forecolor="#333333"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Status]]></text>
            </staticText>
            <staticText>
                <reportElement x="330" y="87" width="100" height="16" forecolor="#333333"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Progress]]></text>
            </staticText>
            <staticText>
                <reportElement x="440" y="87" width="120" height="16" forecolor="#333333"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Current Stage]]></text>
            </staticText>
            <staticText>
                <reportElement x="570" y="87" width="100" height="16" forecolor="#333333"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Enrolled Date]]></text>
            </staticText>
            <staticText>
                <reportElement x="680" y="87" width="90" height="16" forecolor="#333333"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="Arial" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[Due Date]]></text>
            </staticText>
            
            <!-- Certification List Display -->
            <textField>
                <reportElement x="10" y="110" width="760" height="60" forecolor="#555555"/>
                <textElement textAlignment="Left" verticalAlignment="Top">
                    <font fontName="Arial" size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{certifications} != null && !((java.util.List)$F{certifications}).isEmpty() ? 
                    ((java.util.List)$F{certifications}).stream()
                        .map(cert -> {
                            com.certreport.dto.CertificationDto certification = (com.certreport.dto.CertificationDto)cert;
                            String name = certification.getCertificationDefinition() != null ? 
                                certification.getCertificationDefinition().getName() : "Unknown Certification";
                            String status = certification.getStatus() != null ? certification.getStatus().toString() : "UNKNOWN";
                            String progress = certification.getCompletionPercentage() != null ? 
                                String.format("%.1f%%", certification.getCompletionPercentage()) : "0%";
                            String currentStage = certification.getCurrentStageName() != null ? 
                                certification.getCurrentStageName() : "N/A";
                            String enrolledDate = certification.getEnrolledAt() != null ? 
                                certification.getEnrolledAt().format(java.time.format.DateTimeFormatter.ofPattern("yyyy-MM-dd")) : "N/A";
                            String dueDate = certification.getDueDate() != null ? 
                                certification.getDueDate().format(java.time.format.DateTimeFormatter.ofPattern("yyyy-MM-dd")) : "N/A";
                            return String.format("• %s | %s | %s | %s | %s | %s", 
                                name, status, progress, currentStage, enrolledDate, dueDate);
                        })
                        .collect(java.util.stream.Collectors.joining("\n"))
                    : "No certifications found for this employee during the selected period."]]></textFieldExpression>
            </textField>
            
            <!-- Section 3: Activity Details Header -->
            <rectangle>
                <reportElement mode="Opaque" x="0" y="190" width="782" height="30" backcolor="#C73E1D"/>
            </rectangle>
            <staticText>
                <reportElement x="10" y="195" width="400" height="20" forecolor="#FFFFFF"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="14" isBold="true"/>
                </textElement>
                <text><![CDATA[Section 3: Activity Details]]></text>
            </staticText>
            
            <!-- Activity Details Content -->
            <textField>
                <reportElement x="10" y="230" width="760" height="120" forecolor="#555555"/>
                <textElement textAlignment="Left" verticalAlignment="Top">
                    <font fontName="Arial" size="9"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{certifications} != null && !((java.util.List)$F{certifications}).isEmpty() ? 
                    ((java.util.List)$F{certifications}).stream()
                        .map(cert -> {
                            com.certreport.dto.CertificationDto certification = (com.certreport.dto.CertificationDto)cert;
                            String certName = certification.getCertificationDefinition() != null ? 
                                certification.getCertificationDefinition().getName() : "Unknown Certification";
                            
                            StringBuilder activities = new StringBuilder();
                            activities.append("CERTIFICATION: ").append(certName).append("\n");
                            
                            if (certification.getStageProgress() != null && !certification.getStageProgress().isEmpty()) {
                                certification.getStageProgress().forEach(stage -> {
                                    activities.append("  STAGE: ").append(stage.getName() != null ? stage.getName() : "Unknown Stage")
                                             .append(" - Status: ").append(stage.getStatus() != null ? stage.getStatus().toString() : "UNKNOWN")
                                             .append(" - Progress: ").append(stage.getCompletionPercentage() != null ? 
                                                 String.format("%.1f%%", stage.getCompletionPercentage()) : "0%");
                                    if (stage.getStartedAt() != null) {
                                        activities.append(" - Started: ").append(stage.getStartedAt().format(java.time.format.DateTimeFormatter.ofPattern("yyyy-MM-dd")));
                                    }
                                    if (stage.getCompletedAt() != null) {
                                        activities.append(" - Completed: ").append(stage.getCompletedAt().format(java.time.format.DateTimeFormatter.ofPattern("yyyy-MM-dd")));
                                    }
                                    activities.append("\n");
                                });
                            } else {
                                activities.append("  No stage information available\n");
                            }
                            
                            return activities.toString();
                        })
                        .collect(java.util.stream.Collectors.joining("\n"))
                    : "No certification activities found for this employee during the selected period."]]></textFieldExpression>
            </textField>
            
            <!-- Report Generation Info -->
            <staticText>
                <reportElement x="10" y="360" width="750" height="15" forecolor="#666666"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="Arial" size="8" isItalic="true"/>
                </textElement>
                <text><![CDATA[Report includes comprehensive certification data with status indicators and activity tracking for audit compliance.]]></text>
            </staticText>
        </band>
    </summary>
    
</jasperReport>
